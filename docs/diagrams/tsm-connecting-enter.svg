<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2912px" preserveAspectRatio="none" style="width:3328px;height:2912px;background:#FFFFFF;" version="1.1" viewBox="0 0 3328 2912" width="3328px" zoomAndPan="magnify"><defs/><g><rect fill="#F1F1F1" height="160" rx="50" ry="50" style="stroke:#181818;stroke-width:2.0;" width="728" x="2162" y="348"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="688" x="2182" y="449.7246">Entering connecting state</text><rect fill="#F1F1F1" height="160" rx="50" ry="50" style="stroke:#181818;stroke-width:2.0;" width="536" x="2258" y="824"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="496" x="2278" y="925.7246">Check offline state</text><rect fill="#F1F1F1" height="160" rx="50" ry="50" style="stroke:#181818;stroke-width:2.0;" width="808" x="1570" y="1300"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="768" x="1590" y="1401.7246">Generate tunnel parameters</text><rect fill="#F1F1F1" height="160" rx="50" ry="50" style="stroke:#181818;stroke-width:2.0;" width="512" x="790" y="1776"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="472" x="810" y="1877.7246">Set firewall policy</text><rect fill="#F1F1F1" height="160" rx="50" ry="50" style="stroke:#181818;stroke-width:2.0;" width="412" x="28" y="2252"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="372" x="48" y="2353.7246">Spawn tunnel</text><rect fill="#F1F1F1" height="160" rx="50" ry="50" style="stroke:#181818;stroke-width:2.0;" width="492" x="656" y="2728"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="452" x="676" y="2829.7246">Connecting state</text><rect fill="#F1F1F1" height="160" rx="50" ry="50" style="stroke:#181818;stroke-width:2.0;" width="484" x="2740" y="2252"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="444" x="2760" y="2353.7246">Enter error state</text><rect fill="#F1F1F1" height="160" rx="50" ry="50" style="stroke:#181818;stroke-width:2.0;" width="1056" x="1042" y="2252"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="1016" x="1062" y="2353.7246">Starting a tunnel in a separate thread</text><ellipse cx="2526" cy="64" fill="#222222" rx="40" ry="40" style="stroke:none;stroke-width:4.0;"/><!--MD5=[856b139558eaca79d462b9bcbcf281ff]
link *start to enter_connecting--><g id="link_*start_enter_connecting"><path d="M2526,104.76 C2526,156.72 2526,253.52 2526,326.92 " fill="none" id="*start-to-enter_connecting" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="2526,346.96,2542,310.96,2526,326.96,2510,310.96,2526,346.96" style="stroke:#181818;stroke-width:4.0;"/></g><!--MD5=[7826b37739f3537a008e6487032855d3]
link enter_connecting to offline--><g id="link_enter_connecting_offline"><path d="M2526,508.24 C2526,588.8 2526,716.08 2526,803.56 " fill="none" id="enter_connecting-to-offline" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="2526,823.8,2542,787.8,2526,803.8,2510,787.8,2526,823.8" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="436" x="2530" y="687.5801">Check offline state</text></g><!--MD5=[36a178d2ae9a423449730d6c630b6d84]
link offline to ask_gen_parameters--><g id="link_offline_ask_gen_parameters"><path d="M2436.08,984.24 C2338.64,1066.84 2183.28,1198.56 2080,1286.12 " fill="none" id="offline-to-ask_gen_parameters" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="2063.88,1299.8,2101.671,1288.6716,2079.1174,1286.8454,2080.9436,1264.2918,2063.88,1299.8" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="420" x="2290" y="1163.5801">Host is not offline</text></g><!--MD5=[1590fbf3f5d32f77edd083783dac6613]
link offline to enter_error--><g id="link_offline_enter_error"><path d="M2632.76,984.8 C2672.64,1017.8 2715.56,1059.12 2746,1104 C2924.28,1367.04 2934.96,1463.08 2990,1776 C3017.56,1932.64 3006.04,2118.12 2994.52,2229.28 " fill="none" id="offline-to-enter_error" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="2992.2,2250.48,3012.0133,2216.4295,2994.371,2230.5982,2980.2024,2212.9559,2992.2,2250.48" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="324" x="2974" y="1639.5801">Host is offline</text></g><!--MD5=[efc8a42e02d7ab7fb3aa0c458be12165]
link ask_gen_parameters to set_firewall--><g id="link_ask_gen_parameters_set_firewall"><path d="M1569.8,1417.96 C1347.4,1445.92 1102.88,1495.28 1034,1580 C994.96,1628 999,1698.08 1012.24,1755.04 " fill="none" id="ask_gen_parameters-to-set_firewall" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="1017.48,1775.4,1024.0288,1736.5527,1012.5084,1756.0278,993.0333,1744.5073,1017.48,1775.4" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="828" x="1038" y="1639.5801">Successfully generated parameters</text></g><!--MD5=[4a789b252a94ef911e0bb3734d8b9bb5]
link ask_gen_parameters to enter_error--><g id="link_ask_gen_parameters_enter_error"><path d="M1967.96,1460.96 C1963.08,1576.88 1970.72,1797.44 2082,1936 C2239.64,2132.32 2515.08,2232.6 2719.84,2282.32 " fill="none" id="ask_gen_parameters-to-enter_error" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="2739.44,2286.96,2708.1123,2263.0733,2719.9814,2282.3379,2700.7169,2294.207,2739.44,2286.96" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="884" x="2086" y="1877.5801">Failed to generate tunnel parameters</text></g><!--MD5=[fb89bac07f7a11d66ff13a519796f15e]
link set_firewall to spawn_tunnel--><g id="link_set_firewall_spawn_tunnel"><path d="M789.52,1892.08 C588.24,1922.88 330.92,1976.48 262,2056 C221,2103.28 214.8,2174 218.44,2231.44 " fill="none" id="set_firewall-to-spawn_tunnel" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="220.16,2251.96,233.018,2214.722,218.4471,2232.0335,201.1356,2217.4626,220.16,2251.96" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="700" x="266" y="2115.5801">Successfully set firewall policy</text></g><!--MD5=[1896629d910e560289477b060e00c9e6]
link set_firewall to enter_error--><g id="link_set_firewall_enter_error"><path d="M1078.96,1936.08 C1110.84,1999.8 1165.64,2087.32 1242,2132 C1304.8,2168.72 2246.36,2260.08 2717.56,2303.88 " fill="none" id="set_firewall-to-enter_error" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="2738.24,2305.8,2703.8513,2286.5798,2718.3235,2303.9738,2700.9295,2318.4461,2738.24,2305.8" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="620" x="1246" y="2115.5801">Failed to set firewall policy</text></g><!--MD5=[7324297b97284037cc9d064b198f1e52]
link spawn_tunnel to connecting_state--><g id="link_spawn_tunnel_connecting_state"><path d="M289.16,2413 C334.6,2472.24 403.52,2552.96 478,2608 C537.32,2651.84 608,2689.24 674.48,2719.28 " fill="none" id="spawn_tunnel-to-connecting_state" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="693.12,2727.56,666.704,2698.3333,674.8391,2719.4478,653.7246,2727.5829,693.12,2727.56" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="680" x="482" y="2591.5801">Successfully spawned tunnel</text></g><!--MD5=[d2bc329681f17925b57bc873fcb401c5]
link spawn_tunnel to starting_tunnel--><g id="link_spawn_tunnel_starting_tunnel"><path d="M441.28,2332 C596.48,2332 816.32,2332 1020.84,2332 " fill="none" id="spawn_tunnel-to-starting_tunnel" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="1041.84,2332,1005.84,2316,1021.84,2332,1005.84,2348,1041.84,2332" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="456" x="513" y="2303.5801">Start tunnel thread</text></g><!--MD5=[e47536a8c8485ad745bb3337664ad37c]
link starting_tunnel to enter_error--><g id="link_starting_tunnel_enter_error"><path d="M2098.8,2332 C2310.2,2332 2544.28,2332 2718.32,2332 " fill="none" id="starting_tunnel-to-enter_error" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="2739.24,2332,2703.24,2316,2719.24,2332,2703.24,2348,2739.24,2332" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="496" x="2171" y="2303.5801">Failed to start tunnel</text></g><!--MD5=[4dcbab9c1a205767e76de38b88cac69b]
link starting_tunnel to connecting_state--><g id="link_starting_tunnel_connecting_state"><path d="M1468.28,2412.32 C1394.04,2467.6 1290.6,2543.56 1198,2608 C1145.72,2644.4 1087.44,2683.32 1036.52,2716.84 " fill="none" id="starting_tunnel-to-connecting_state" style="stroke:#181818;stroke-width:4.0;"/><polygon fill="#181818" points="1019.52,2727.96,1058.3905,2721.5503,1036.2311,2716.9719,1040.8095,2694.8125,1019.52,2727.96" style="stroke:#181818;stroke-width:4.0;"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="908" x="1306" y="2591.5801">Send tunnel event to connecting state</text></g><!--MD5=[efd1fb0bd0cec458add53945c27c9e31]
@startuml
hide empty description
scale 800

state "Entering connecting state" as enter_connecting 
state "Check offline state" as offline
state "Generate tunnel parameters" as ask_gen_parameters
state "Set firewall policy" as set_firewall
state "Spawn tunnel" as spawn_tunnel
state "Connecting state" as connecting_state
state "Enter error state" as enter_error
state "Starting a tunnel in a separate thread" as starting_tunnel

[*] - -> enter_connecting 
enter_connecting - -> offline : Check offline state
offline - -> ask_gen_parameters : Host is not offline
offline - -> enter_error : Host is offline
ask_gen_parameters - -> set_firewall : Successfully generated parameters
ask_gen_parameters - -> enter_error : Failed to generate tunnel parameters
set_firewall - -> spawn_tunnel : Successfully set firewall policy
set_firewall - -> enter_error : Failed to set firewall policy
spawn_tunnel - -> connecting_state : Successfully spawned tunnel
spawn_tunnel -> starting_tunnel : Start tunnel thread
starting_tunnel -> enter_error : Failed to start tunnel
starting_tunnel -> connecting_state : Send tunnel event to connecting state


@enduml

PlantUML version 1.2022.3(Tue Mar 29 17:10:57 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>