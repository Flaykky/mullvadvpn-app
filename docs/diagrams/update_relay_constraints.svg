<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1940px" preserveAspectRatio="none" style="width:4344px;height:1940px;background:#FFFFFF;" version="1.1" viewBox="0 0 4344 1940" width="4344px" zoomAndPan="magnify"><defs/><g><rect height="116.2617" style="stroke:#00000000;stroke-width:4.0;fill:none;" width="2692" x="823" y="40"/><text fill="#000000" font-family="sans-serif" font-size="56" font-weight="bold" lengthAdjust="spacing" textLength="344" x="843" y="119.8555">Execution of</text><text fill="#000000" font-family="monospace" font-size="56" font-weight="bold" lengthAdjust="spacing" textLength="588" x="1203" y="126.9098">update_relay_settings</text><text fill="#000000" font-family="sans-serif" font-size="56" font-weight="bold" lengthAdjust="spacing" textLength="1688" x="1807" y="119.8555">RPC when relay settings have changed, but the key is invalid.</text><line style="stroke:#181818;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="352" x2="352" y1="316.5234" y2="1791.4824"/><line style="stroke:#181818;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="1054" x2="1054" y1="316.5234" y2="1791.4824"/><line style="stroke:#181818;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="1654" x2="1654" y1="316.5234" y2="1791.4824"/><line style="stroke:#181818;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="2042" x2="2042" y1="316.5234" y2="1791.4824"/><line style="stroke:#181818;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="2618" x2="2618" y1="316.5234" y2="1791.4824"/><line style="stroke:#181818;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="3242" x2="3242" y1="316.5234" y2="1791.4824"/><line style="stroke:#181818;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="3934" x2="3934" y1="316.5234" y2="1791.4824"/><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="668" x="20" y="180.2617"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="612" x="48" y="268.1172">Management interface</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="668" x="20" y="1787.4824"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="612" x="48" y="1875.3379">Management interface</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="280" x="914" y="180.2617"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="224" x="942" y="268.1172">Daemon</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="280" x="914" y="1787.4824"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="224" x="942" y="1875.3379">Daemon</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="272" x="1518" y="180.2617"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="216" x="1546" y="268.1172">Settings</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="272" x="1518" y="1787.4824"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="216" x="1546" y="1875.3379">Settings</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="428" x="1830" y="180.2617"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="372" x="1858" y="268.1172">Relay selector</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="428" x="1830" y="1787.4824"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="372" x="1858" y="1875.3379">Relay selector</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="640" x="2298" y="180.2617"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="584" x="2326" y="268.1172">Tunnel state machine</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="640" x="2298" y="1787.4824"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="584" x="2326" y="1875.3379">Tunnel state machine</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="528" x="2978" y="180.2617"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="472" x="3006" y="268.1172">Account maanger</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="528" x="2978" y="1787.4824"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="472" x="3006" y="1875.3379">Account maanger</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="776" x="3546" y="180.2617"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="720" x="3574" y="268.1172">Daemon event subscribers</text><rect fill="#E2E2F0" height="132.2617" rx="10" ry="10" style="stroke:#181818;stroke-width:2.0;" width="776" x="3546" y="1787.4824"/><text fill="#000000" font-family="sans-serif" font-size="56" lengthAdjust="spacing" textLength="720" x="3574" y="1875.3379">Daemon event subscribers</text><polygon fill="#181818" points="1006,435.3379,1046,451.3379,1006,467.3379,1022,451.3379" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="354" x2="1030" y1="451.3379" y2="451.3379"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="332" x="382" y="428.1035">Incoming RPC</text><polygon fill="#181818" points="1606,562.1523,1646,578.1523,1606,594.1523,1622,578.1523" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1054" x2="1630" y1="578.1523" y2="578.1523"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="504" x="1082" y="554.918">Update relay settings</text><polygon fill="#181818" points="398,688.9668,358,704.9668,398,720.9668,382,704.9668" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="374" x2="1050" y1="704.9668" y2="704.9668"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="604" x="422" y="681.7324">Return save result to RPC</text><polygon fill="#181818" points="3886,815.7813,3926,831.7813,3886,847.7813,3902,831.7813" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1054" x2="3910" y1="831.7813" y2="831.7813"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="900" x="1082" y="808.5469">Publish new settings to all subscribers</text><polygon fill="#181818" points="1996,942.5957,2036,958.5957,1996,974.5957,2012,958.5957" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1054" x2="2020" y1="958.5957" y2="958.5957"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="584" x="1082" y="935.3613">Update relay constraints</text><polygon fill="#181818" points="2570,1069.4102,2610,1085.4102,2570,1101.4102,2586,1085.4102" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1054" x2="2594" y1="1085.4102" y2="1085.4102"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="420" x="1082" y="1062.1758">Reconnect tunnel</text><polygon fill="#181818" points="1098,1196.2246,1058,1212.2246,1098,1228.2246,1082,1212.2246" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1074" x2="2614" y1="1212.2246" y2="1212.2246"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="764" x="1122" y="1188.9902">Request new tunnel parameters</text><polygon fill="#181818" points="2570,1323.0391,2610,1339.0391,2570,1355.0391,2586,1339.0391" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1054" x2="2594" y1="1339.0391" y2="1339.0391"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="576" x="1082" y="1315.8047">Send tunnel parameters</text><polygon fill="#181818" points="1098,1449.8535,1058,1465.8535,1098,1481.8535,1082,1465.8535" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1074" x2="2614" y1="1465.8535" y2="1465.8535"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="584" x="1122" y="1442.6191">Publish connecting state</text><polygon fill="#181818" points="3194,1576.668,3234,1592.668,3194,1608.668,3210,1592.668" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1054" x2="3218" y1="1592.668" y2="1592.668"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="864" x="1082" y="1569.4336">Asynchronously verify account state</text><polygon fill="#181818" points="3886,1703.4824,3926,1719.4824,3886,1735.4824,3902,1719.4824" style="stroke:#181818;stroke-width:4.0;"/><line style="stroke:#181818;stroke-width:4.0;" x1="1054" x2="3910" y1="1719.4824" y2="1719.4824"/><text fill="#000000" font-family="sans-serif" font-size="52" lengthAdjust="spacing" textLength="588" x="1082" y="1696.248">Publish new tunnel state</text><!--MD5=[92efeda41c0521e6848b9ba42c87afbf]
@startuml
hide empty description
scale 800

title Execution of ""update_relay_settings"" RPC when relay settings have changed, but the key is invalid.

participant "Management interface" as management_interface
participant "Daemon" as daemon
participant "Settings" as settings
participant "Relay selector" as relay_selector
participant "Tunnel state machine" as tsm
participant "Account maanger" as account_manager
participant "Daemon event subscribers" as subscribers

management_interface -> daemon : Incoming RPC
daemon -> settings : Update relay settings
daemon -> management_interface : Return save result to RPC
daemon ->  subscribers : Publish new settings to all subscribers
daemon -> relay_selector : Update relay constraints
daemon -> tsm : Reconnect tunnel
tsm -> daemon : Request new tunnel parameters
daemon -> tsm : Send tunnel parameters
tsm -> daemon : Publish connecting state
daemon -> account_manager : Asynchronously verify account state
daemon -> subscribers : Publish new tunnel state

@enduml

PlantUML version 1.2022.3(Tue Mar 29 17:10:57 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>